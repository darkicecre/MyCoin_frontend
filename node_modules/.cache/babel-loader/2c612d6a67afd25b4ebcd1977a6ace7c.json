{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _indexJs = require(\"../actions/dragDrop/index.js\");\n\nclass DragDropManagerImpl {\n  receiveBackend(backend) {\n    this.backend = backend;\n  }\n\n  getMonitor() {\n    return this.monitor;\n  }\n\n  getBackend() {\n    return this.backend;\n  }\n\n  getRegistry() {\n    return this.monitor.registry;\n  }\n\n  getActions() {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    const manager = this;\n    const {\n      dispatch\n    } = this.store;\n\n    function bindActionCreator(actionCreator) {\n      return function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        const action = actionCreator.apply(manager, args);\n\n        if (typeof action !== 'undefined') {\n          dispatch(action);\n        }\n      };\n    }\n\n    const actions = (0, _indexJs).createDragDropActions(this);\n    return Object.keys(actions).reduce((boundActions, key) => {\n      const action = actions[key];\n      boundActions[key] = bindActionCreator(action);\n      return boundActions;\n    }, {});\n  }\n\n  dispatch(action) {\n    this.store.dispatch(action);\n  }\n\n  constructor(store, monitor) {\n    this.isSetUp = false;\n\n    this.handleRefCountChange = () => {\n      const shouldSetUp = this.store.getState().refCount > 0;\n\n      if (this.backend) {\n        if (shouldSetUp && !this.isSetUp) {\n          this.backend.setup();\n          this.isSetUp = true;\n        } else if (!shouldSetUp && this.isSetUp) {\n          this.backend.teardown();\n          this.isSetUp = false;\n        }\n      }\n    };\n\n    this.store = store;\n    this.monitor = monitor;\n    store.subscribe(this.handleRefCountChange);\n  }\n\n}\n\nexports.DragDropManagerImpl = DragDropManagerImpl;","map":{"version":3,"mappings":";;;;;;AAWsC,YAA8B,0CAA9B;;MAEzBA,oBAAmB;EAYxBC,cAAc,CAACC,OAAD,EAAyB;IAC7C,KAAKA,OAAL,GAAeA,OAAf;EACA;;EAEMC,UAAU,GAAoB;IACpC,OAAO,KAAKC,OAAZ;EACA;;EAEMC,UAAU,GAAY;IAC5B,OAAO,KAAKH,OAAZ;EACA;;EAEMI,WAAW,GAAoB;IACrC,OAAQ,KAAKF,OAAL,CAAqCG,QAA7C;EACA;;EAEMC,UAAU,GAAoB;IACpC;IACA,MAAMC,OAAO,GAAG,IAAhB;IACA,MAAM;MAAEC;IAAF,IAAe,KAAKC,KAA1B;;aAESC,kBAAkBC,eAAmC;MAC7D,OAAM,YAAqB;QAAA,kCAAhBC,IAAgB;UAAhBA,IAAgB;QAAA;;QAC1B,MAAMC,MAAM,GAAGF,aAAa,CAACG,KAAdH,CAAoBJ,OAApBI,EAA6BC,IAA7BD,CAAf;;QACA,IAAI,OAAOE,MAAP,KAAkB,WAAtB,EAAmC;UAClCL,QAAQ,CAACK,MAAD,CAARL;QACA;MACD,CALD;IAMA;;IAED,MAAMO,OAAO,OAAGC,QAAH,EAAwBA,qBAAxB,CAAyB,IAAzB,CAAb;IAEA,OAAOC,MAAM,CAACC,IAAPD,CAAYF,OAAZE,EAAqBE,MAArBF,CAA2B,CAChCG,YADgC,EACDC,GADC,KACe;MAC/C,MAAMR,MAAM,GAAwBE,OAAO,CAC1CM,GAD0C,CAA3C;MAGED,YAAY,CAASC,GAAT,CAAZD,GAA4BV,iBAAiB,CAACG,MAAD,CAA7CO;MACF,OAAOA,YAAP;IACA,CAPKH,EAQN,EARMA,CAAP;EAUA;;EAEMT,QAAQ,CAACK,MAAD,EAA4B;IAC1C,KAAKJ,KAAL,CAAWD,QAAX,CAAoBK,MAApB;EACA;;cApDkBJ,OAAqBP,SAA0B;IAN5D,KAIEoB,OAJF,GAIY,KAJZ;;IAAA,KA4DEC,oBA5DF,GA4DsB,MAAe;MAC1C,MAAMC,WAAW,GAAG,KAAKf,KAAL,CAAWgB,QAAX,GAAsBC,QAAtB,GAAiC,CAArD;;MACA,IAAI,KAAK1B,OAAT,EAAkB;QACjB,IAAIwB,WAAW,KAAK,KAAKF,OAAzB,EAAkC;UACjC,KAAKtB,OAAL,CAAa2B,KAAb;UACA,KAAKL,OAAL,GAAe,IAAf;QACA,CAHD,MAGO,IAAE,CAAGE,WAAH,IAAkB,KAAKF,OAAzB,EAAkC;UACxC,KAAKtB,OAAL,CAAa4B,QAAb;UACA,KAAKN,OAAL,GAAe,KAAf;QACA;MACD;IACD,CAvEK;;IAOL,KAAKb,KAAL,GAAaA,KAAb;IACA,KAAKP,OAAL,GAAeA,OAAf;IACAO,KAAK,CAACoB,SAANpB,CAAgB,KAAKc,oBAArBd;EACA;;AAV8B;;QAAnBX","names":["DragDropManagerImpl","receiveBackend","backend","getMonitor","monitor","getBackend","getRegistry","registry","getActions","manager","dispatch","store","bindActionCreator","actionCreator","args","action","apply","actions","createDragDropActions","Object","keys","reduce","boundActions","key","isSetUp","handleRefCountChange","shouldSetUp","getState","refCount","setup","teardown","subscribe"],"sources":["../../../src/classes/DragDropManagerImpl.ts"],"sourcesContent":["import type { Store, Action } from 'redux'\nimport type { DragDropMonitorImpl } from './DragDropMonitorImpl.js'\nimport type { State } from '../reducers/index.js'\nimport type {\n\tActionCreator,\n\tBackend,\n\tDragDropActions,\n\tDragDropMonitor,\n\tDragDropManager,\n\tHandlerRegistry,\n} from '../interfaces.js'\nimport { createDragDropActions } from '../actions/dragDrop/index.js'\n\nexport class DragDropManagerImpl implements DragDropManager {\n\tprivate store: Store<State>\n\tprivate monitor: DragDropMonitor\n\tprivate backend: Backend | undefined\n\tprivate isSetUp = false\n\n\tpublic constructor(store: Store<State>, monitor: DragDropMonitor) {\n\t\tthis.store = store\n\t\tthis.monitor = monitor\n\t\tstore.subscribe(this.handleRefCountChange)\n\t}\n\n\tpublic receiveBackend(backend: Backend): void {\n\t\tthis.backend = backend\n\t}\n\n\tpublic getMonitor(): DragDropMonitor {\n\t\treturn this.monitor\n\t}\n\n\tpublic getBackend(): Backend {\n\t\treturn this.backend as Backend\n\t}\n\n\tpublic getRegistry(): HandlerRegistry {\n\t\treturn (this.monitor as DragDropMonitorImpl).registry\n\t}\n\n\tpublic getActions(): DragDropActions {\n\t\t/* eslint-disable-next-line @typescript-eslint/no-this-alias */\n\t\tconst manager = this\n\t\tconst { dispatch } = this.store\n\n\t\tfunction bindActionCreator(actionCreator: ActionCreator<any>) {\n\t\t\treturn (...args: any[]) => {\n\t\t\t\tconst action = actionCreator.apply(manager, args as any)\n\t\t\t\tif (typeof action !== 'undefined') {\n\t\t\t\t\tdispatch(action)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst actions = createDragDropActions(this)\n\n\t\treturn Object.keys(actions).reduce(\n\t\t\t(boundActions: DragDropActions, key: string) => {\n\t\t\t\tconst action: ActionCreator<any> = (actions as any)[\n\t\t\t\t\tkey\n\t\t\t\t] as ActionCreator<any>\n\t\t\t\t;(boundActions as any)[key] = bindActionCreator(action)\n\t\t\t\treturn boundActions\n\t\t\t},\n\t\t\t{} as DragDropActions,\n\t\t)\n\t}\n\n\tpublic dispatch(action: Action<any>): void {\n\t\tthis.store.dispatch(action)\n\t}\n\n\tprivate handleRefCountChange = (): void => {\n\t\tconst shouldSetUp = this.store.getState().refCount > 0\n\t\tif (this.backend) {\n\t\t\tif (shouldSetUp && !this.isSetUp) {\n\t\t\t\tthis.backend.setup()\n\t\t\t\tthis.isSetUp = true\n\t\t\t} else if (!shouldSetUp && this.isSetUp) {\n\t\t\t\tthis.backend.teardown()\n\t\t\t\tthis.isSetUp = false\n\t\t\t}\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"script"}